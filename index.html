<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ficha de treino - Vitorgabrieldev</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA7jOfxrnqm2bVrfjy6vnrw1ZreSlXsTtU",
            authDomain: "plataforma-de-treino-478700.firebaseapp.com",
            projectId: "plataforma-de-treino-478700",
            storageBucket: "plataforma-de-treino-478700.firebasestorage.app",
            messagingSenderId: "508989645046",
            appId: "1:508989645046:web:4d98c43f62f1791f03ccd7"
        };

        window.FIREBASE_CONFIG = firebaseConfig;

        firebase.initializeApp(firebaseConfig);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Select2 (estilização do select de fichas) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- SortableJS for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- Mistral API key placeholder: set your key here (insecure in-browser; use a proxy in production) -->
    <script>
        // Example: window.MISTRAL_API_KEY = 'sk-xxxx';
        window.MISTRAL_API_KEY = '';
        // Use the Vercel serverless proxy endpoint (your function `api/mistral.js`):
        window.MISTRAL_PROXY_URL = '/api/mistral';
    </script>
</head>

<body class="bg-slate-900 text-white p-4">
    <!-- PIN overlay: blocks access until unlocked -->
    <div id="pinOverlay" class="pin-overlay hidden">
        <div class="pin-box">
            <h2>Digite o PIN</h2>
            <p class="pin-sub">Insira o PIN de 4 dígitos para acessar o app</p>
            <input id="pinInput" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="4" placeholder="••••" autocomplete="one-time-code" />
            <div style="display:flex; gap:8px; margin-top:12px; align-items:center; justify-content:center">
                <button id="pinSubmit" class="btn-primary">Entrar</button>
            </div>
        </div>
    </div>
    <div class="app-shell">
        <div class="tabs" role="tablist" aria-label="Navegação principal">
            <button class="tab-btn" data-tab="ficha" id="tab-btn-ficha">Ficha</button>
            <button class="tab-btn" data-tab="chat" id="tab-btn-chat">Treinador</button>
            <button class="tab-btn" data-tab="calendario" id="tab-btn-calendario">Calendário</button>
            <button class="tab-btn" data-tab="historico" id="tab-btn-historico">Histórico</button>
            <button class="tab-btn" data-tab="config" id="tab-btn-config">Configurações</button>
        </div>

        <!-- added: ficha selector toolbar -->
        <div class="ficha-toolbar" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
            <label for="fichaSelect" style="color:var(--muted)">Ficha:</label>
            <select id="fichaSelect" style="background:transparent; border:1px solid rgba(255,255,255,0.04); color:inherit; padding:6px 8px; border-radius:8px; min-width:240px"></select>
            <div id="fichaLoader" style="display:none; margin-left:6px; color:var(--muted); font-size:13px">
                <span class="loader-dot"></span> Carregando...
            </div>
            <button id="newFichaBtn" class="btn-primary small">Nova ficha</button>
            <div style="margin-left:auto; display:flex; gap:8px;">
                <button id="manageFichaBtn" class="btn-secondary small">Editar ficha</button>
                <button id="exportJsonBtn" class="btn-secondary small">Exportar JSON</button>
                <button id="importJsonBtn" class="btn-secondary small">Importar JSON</button>
            </div>
        </div>

        <div class="tab-content" id="tab-ficha">
            <h2 class="text-xl font-bold mb-4">Ficha de treino semanal</h2>
            <div id="weekGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3"></div>
        </div>

        <div class="tab-content hidden" id="tab-chat">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:8px">
                <h2 class="text-xl font-bold mb-4">Agente de inteligência artificial</h2>
                <div>
                    <button id="chatClear" class="btn-secondary small">Limpar</button>
                </div>
            </div>
            <div class="chat-box">
                <div id="chatMessages" class="chat-messages"></div>
                <div class="chat-input-row">
                    <input id="chatInput" placeholder="Escreva sua pergunta ao treinador..." />
                    <button id="chatSend" class="btn-primary">Enviar</button>
                </div>
            </div>
        </div>

        <div class="tab-content hidden" id="tab-calendario">
            <div class="calendar-toolbar">
                <button id="calendarPrev" class="btn-secondary small" aria-label="Semanas anteriores"><i class="bi bi-chevron-left"></i></button>
                <div class="calendar-range">
                    <span id="calendarRangeLabel"></span>
                </div>
                <button id="calendarNext" class="btn-secondary small" aria-label="Próximas semanas"><i class="bi bi-chevron-right"></i></button>
            </div>
            <div class="note">Visualize blocos de 4 semanas. Clique na semana para editar tipo/carga ou escolha um dia para adicionar observações.</div>
            <div id="calendarWeeks" class="calendar-weeks"></div>
        </div>

        <div class="tab-content hidden" id="tab-historico">
            <h2 class="text-xl font-bold mb-4">Histórico</h2>
            <div id="historyList" class="note">Nenhum histórico ainda.</div>
        </div>

        <div class="tab-content hidden" id="tab-config">
            <h2 class="text-xl font-bold mb-4">Configurações</h2>
            <div class="note">Opções: PIN, sincronização, preferências (placeholder)</div>
        </div>
    </div>

    <div id="modalWrap" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
        <div class="modal">
            <h3 id="modalTitle" class="modal-title"></h3>

            <input id="exerciseName" placeholder="Nome do exercício" class="modal-input" />
            <textarea id="exerciseObs" placeholder="Observações" class="modal-input"></textarea>

            <div style="display:flex; justify-content:space-between; gap:8px; align-items:center">
                <button id="addSeries" class="btn-primary small">Adicionar série</button>
            </div>

                        <div id="seriesList" class="series-list">
                                <div class="table-wrap">
                                    <table class="series-table modal-series-table">
                                        <thead>
                                            <tr>
                                                <th>Série</th>
                                                <th>Peso</th>
                                                <th>Repetições</th>
                                                <th>RPE</th>
                                                <th>Descanso</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="seriesTableBody"></tbody>
                                    </table>
                                </div>
                        </div>

            <div class="actions">
                <button id="saveExercise" class="btn-primary">Salvar</button>
                <button id="deleteExercise" class="btn-danger hidden">Excluir</button>
                <button id="closeModal" class="btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <div id="fichaModalWrap" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
        <div class="modal ficha-modal">
            <h3 class="modal-title">Editar ficha</h3>
            <input id="fichaNameInput" placeholder="Nome da ficha" class="modal-input" />
            <div class="actions">
                <button id="fichaSaveBtn" class="btn-primary">Salvar alterações</button>
                <button id="fichaDeleteBtn" class="btn-danger">Excluir ficha</button>
                <button id="fichaModalClose" class="btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <div id="weekModalWrap" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
        <div class="modal ficha-modal">
            <h3 class="modal-title">Configurar semana</h3>
            <label class="modal-label" for="weekTypeSelect">Tipo da semana</label>
            <select id="weekTypeSelect" class="modal-input">
                <option value="Base">Base</option>
                <option value="Volume">Volume</option>
                <option value="Intensificação">Intensificação</option>
                <option value="Deload">Deload</option>
                <option value="Peak">Peak</option>
                <option value="Off">Off / Recuperação</option>
            </select>
            <label class="modal-label" for="weekLoadInput">Carga prevista (%)</label>
            <input id="weekLoadInput" type="number" min="0" max="150" class="modal-input" placeholder="Ex.: 85" />
            <label class="modal-label" for="weekNoteInput">Observações gerais</label>
            <textarea id="weekNoteInput" rows="4" class="modal-input" placeholder="Detalhes do foco da semana..."></textarea>
            <div class="actions">
                <button id="weekModalSave" class="btn-primary">Salvar</button>
                <button id="weekModalClose" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="dayModalWrap" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4">
        <div class="modal ficha-modal">
            <h3 class="modal-title" id="dayModalTitle">Anotar dia</h3>
            <div class="note" id="dayModalSubtitle"></div>
            <textarea id="dayNoteInput" rows="5" class="modal-input"></textarea>
            <div class="actions">
                <button id="dayModalSave" class="btn-primary">Salvar anotação</button>
                <button id="dayModalDelete" class="btn-danger">Limpar</button>
                <button id="dayModalClose" class="btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <script src="mistral.js"></script>
    <script src="script.js"></script>
</body>

</html>
